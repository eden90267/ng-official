# 架構

## 架構概覽

- Angular 本身由 TypeScript 寫成的
- Angular 基本構造塊是 NgModule
  - NgModule 為組件提供了編譯的上下文環境
  - 將相關代碼收集到一些功能集中
  - Angular 就是一組 NgModule 定義出的
  - 應用至少有一個引導用的根模組與很多特性模組
- 組件定義視圖
  - 一組可見的屏幕元素
- 組件使用服務
  - 提供與視圖不直接相關的功能
  - 可作為依賴被注入到組件
- 組件和服務
  - 都是簡單的類別
  - 使用裝飾器標出類型
  - 提供元數據以告知 Angular 該如何使用
  - 元數據將類和一個用來定義視圖的模板關聯起來
    - 模板把普通的 HTML 和綁定標記 (markup) 組合起來，這樣 Angular 就可以在呈現 HTML 之前先修改這些 HTML
  - 服務的元數據提供了一些信息，Angular 要用這些信息來讓組件可以透過 DI 使用該服務
- Router 服務幫助你定義視圖之間的導航路徑，提供了先進的瀏覽器內導航功能。

## 模組

- NgModule
  - 為一個組件集聲明編譯的上下文環境
  - 專注於某個應用領域、某個工作流或一組緊密相關的能力
  - 可將其組件和一組相關代碼 (如服務) 關聯起來，形成功能單元
- AppModule
  - 根模組
  - 啟動應用的引導機制
  - 一個應用包含很多功能模組
- NgModule 可從其他 NgModule 導入功能，並允許導出它們自己的功能供其他 NgModule 使用
- 有惰性加載的優點

## 組件

- 至少一個組件 —— 根組件
  - 將組件樹和頁面中的 DOM 連接起來
- 每個組件都會定義一個類，其中包括應用的數據和邏輯，並與一個 HTML 模板相關聯
- `@Component` 裝飾器表明緊隨它的那個類是一個組件，並提供模板和該組件專屬的元數據

> 裝飾器是一些用於裝飾 JavaScript 類的函數。Angular 定義了很多裝飾器，這些裝飾器會把一些特定種類的元數據附加到類上，以便 Angular 了解這些類的含義以及如何使用它們


### 模板、指令和數據綁定

模板會把 HTML 和 Angular 標記 (markup) 組合起來，這些標記可以在 HTML 元素顯示出來之前修改它們。模板指令會提供程序邏輯，而綁定標記會把你應用中的資料和 DOM 連接在一起

- 事件綁定：讓你應用可透過更新應用的資料來響應目標環境下的用戶輸入
- 屬性綁定：讓你將應用資料中計算出來的值插入到 HTML 中

在視圖顯示出來之前，Angular 會先根據你的應用資料和邏輯來進行模板中的指令並解析綁定表達式，以修改 HTML 元素和 DOM。Angular 支持雙向綁定，這意味 DOM 發生變化同樣可反映回你的程序資料中。

你的模板也可用管道轉換要顯示的值以增強用戶體驗。Angular 為一些通用提供預定義管道，你還可自定義。

## 服務與依賴注入

- 與特定視圖無關，並希望跨組件共享資料或邏輯，可創建服務類
- 通常緊跟在 `@Injectable` 裝飾器之後，該裝飾器提供的元數據可讓你的服務作為依賴被注入到客戶組件中
- 依賴注入讓你可以保持組件類的精簡和高效。有了 DI，組件就不用從 Server 獲取資料、驗證用戶或直接把 log 寫到控制台，而是把這些任務委託給服務

### 路由

Angular 的 Router 模組提供了一個服務，它可以讓你定義在應用的各個不同狀態和視圖層次結構之間導航時要使用的路徑。它的工作模型基於人們熟知的瀏覽器約定：

- 地址欄輸入 URL，瀏覽器就會導航到相應的頁面
- 在頁面中點擊鏈接，瀏覽器就會導航到一個新頁面
- 點擊瀏覽器的前進和後退按鈕，瀏覽器就會在你的瀏覽歷史中向前或向後導航

不過路由器是把類似 URL 的路徑映射到視圖而不是頁面。當用戶執行一個動作時，本應該在瀏覽器中加載一個新頁面，但是路由器攔截了瀏覽器的這個行為，並顯示或隱藏一個視圖層次結構。

如果路由器認為當前的應用狀態需要某些特定功能，但尚未加載，路由器就會按需惰性加載此模組。

路由器會根據你應用的導航規則和數據狀態來攔截 URL。導航到新視圖後，路由器會在瀏覽器的歷史日誌中記錄這個動作，所以前進和後退也能正常工作。

要定義導航規則，你就要把導航路徑和你的組件關聯起來。路徑使用類似 URL 語法來讓程序數據整合在一起。你就可以用程序邏輯來決定要顯示或隱藏哪些視圖，以根據你制定的訪問規則。

## 接下來呢？

這張圖展示基礎部分之間的關聯：

![](https://angular.cn/generated/images/guide/architecture/overview2.png)

- 組件和模板共同定義了 Angular 的視圖
  - 組件類的裝飾器為其添加元數據，其中包括指向相關模板的指針
  - 組件模板中的指令和綁定標記會根據程序數據和程序邏輯修改這些視圖
- 依賴注入器會為組件提供一些服務，比如路由器服務就能讓你定義如何在視圖之間導航
